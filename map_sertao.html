<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<title>D3</title>

	<link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto+Slab" rel="stylesheet">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
	<link href="css/fonts.css" rel="stylesheet">
	<style>
		text {
		  font: 10px sans-serif;
		  text-anchor: middle;
		}

		.estados {
			stroke: red;
			stroke-width: 1px;
			fill: none;

		}

		.municipio{
			stroke: grey;
			stroke-width: 0.8px;

		}

	</style>
</head>
<body>

	<div class="container">

		<a href="index.html" class="sidebar-btn"><span class="icon-return"></span> Voltar</a>

		<div class="header">
			<div class="row">
				<div class="col-xs-10">
					<h2>Mapa Semiárido Brasileiro</h2>
				</div>
				<div class="col-xs-2 text-right">
					<a href="https://github.com/arthurlustosa/visualizacao-de-dados/blob/master/bubble.html" target="_blank" class="btn btn-link"><span class="icon-code"></span></a>
					<a href="http://bl.ocks.org/mbostock/4063269" target="_blank" class="btn btn-link"><span class="icon-link-external"></span></a>
				</div>
			</div>
		</div>
		<header>
			<h1>Semiárido Brasileiro</h1>
		</header>
		<div class="row">
			<div class="col-md-8 col-md-offset-2">
				<div id="chart"></div>
			</div>
		</div>

	</div>

	<footer></footer>

	<!-- scripts -->
	<script src="js/d3.v4.min.js"></script>

  	<script src="//d3js.org/topojson.v1.min.js"></script>
  	<script src="https://d3js.org/d3-color.v1.min.js"></script>
	<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<script>
		var
		    width = 1000,
		    height = 1000;

		var svg = d3.select("#chart")
				.append("svg")
				.attr('version', '1.1')
				.attr('viewBox', '0 0 '+width+' '+height)
				.attr('width', '100%')
				.attr('class', 'map-chart');

    var projection = d3.geoAlbers()
        .center([-40.388610, -6.397366])
        .rotate([0, 0])
        .parallels([0, 0])
        .scale(3700);

    var path = d3.geoPath().projection(projection);

    var infoAguaScale = d3.scaleLog();

    d3.queue()
			.defer(d3.json,"data/dados/municipios_sab.json")
			.defer(d3.json, "data/dados/estados_sab.json")
			.defer(d3.csv, "data/dados/dados_snis_filtrados/info_geral.csv")
			.await(draw);

	function draw(error, semiarido, estados, csv) {
      if (error) throw error;


      var estados = topojson.feature(estados, estados.objects.sab_geojson);

      svg.selectAll(".estados")
        .data(estados.features)
      .enter().append("path")
        .attr("d", path)
        .attr("class", "estados");
      console.log(csv);

      var municipios = topojson.feature(semiarido, semiarido.objects.municipios_sab);

      //console.log(municipios.features[0].properties);

      infoAguaScale
      	.domain([d3.min(csv, function(d){return +d.pop_total}), d3.max(csv, function(d){return +d.pop_total})])
      	// .range(d3.schemeBlues[9]);
      	.range(["white", "blue"]);

      svg.selectAll(".municipio")
        .data(municipios.features)
      .enter().append("path")
      	.attr("id", function(d) { var d1 = d.properties.ID.toString().substring(0, 6); return "demanda-"+d1 })
        .attr("d", path)
        .attr("class", "municipio");

        for (var i=0; i < csv.length; i++) {
      		console.log(csv[i].pop_total);
        	svg.select("#demanda-"+csv[i].id)
        		.attr("fill", infoAguaScale(+csv[i].pop_total));
        }

     

    }

	</script>

</body>
</html>
